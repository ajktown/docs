# Auth Flow

<!-- TOC -->

- [Auth Flow](#auth-flow)
  - [Continue with Google](#continue-with-google)
  - [Authentication and Authorization for any API calls](#authentication-and-authorization-for-any-api-calls)

<!-- /TOC -->

## Continue with Google


```plantuml

@startuml

title Continue with Google

participant "End User" as user
participant "FE" as fe
participant "API" as api
database "MongoDB" as db
participant "Google Server" as google

activate user
  user -> user: User wants to continue with Google
  user -> fe: Clicks button `Continue with Google`
  activate fe
    fe -> google: Redirects to Google Sign in page
  deactivate fe
  activate google
    user <- google: Asks Google ID and Password to continue
    user -> google: Input Google ID and Password
    google -> google: Authenticates (Simplified)
    fe <- google: Redirects to FE with temporary access token
  deactivate google
  activate fe
    fe -> api: Send the temporary access token
    activate api
      api -> google: Authenticate the temporary access token
      activate google
        google -> google: Checks the access token if it is generated by Google
        api <- google: Approves if valid (Send google response payload)
      deactivate google
      api -> api: Trusts google response payload
      api -> api: OauthPayloadDomain.fromPayload()
      api -> db: OauthPayloadDomain.toDocument()
      activate db
        api <- db: Returns UserRaw
      deactivate db
      api -> api: UserDomain.fromMdb()
      api -> api: AccessTokenDomain.fromUserDomain()
      fe <- api: Attaches HttpOnly AccessTokenDomain.generateToken() to Nest JS Response
    deactivate api
    user <- fe: Shows successful sign in
  deactivate fe
  user -> user: Use application with signed in status
deactivate user


```

## Authentication and Authorization for any API calls

